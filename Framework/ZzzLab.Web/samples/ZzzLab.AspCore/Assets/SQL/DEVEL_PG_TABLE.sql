--[TABLE_LIST]
SELECT 
    table_schema as SCHEMA_NAME,
    table_name,
	CASE WHEN table_type = 'BASE TABLE' THEN 'TABLE' 
		 ELSE table_type 
	END AS TABLE_TYPE,
	(SELECT DESCRIPTION FROM PG_DESCRIPTION PD WHERE PD.OBJOID = (SELECT RELID FROM PG_STAT_ALL_TABLES PS WHERE PS.RELNAME  = table_name) AND PD.OBJSUBID = 0) AS COMMENTS
FROM information_schema.tables
WHERE table_schema NOT IN ('pg_catalog', 'information_schema')
ORDER BY table_type;

--[TABLE_DETAIL]
SELECT
	ISC.table_schema AS TABLE_SCHEMA,
	ISC.TABLE_NAME AS TABLE_NAME,
	ORDINAL_POSITION AS COLUMN_ORDER,
	UPPER(ISC.COLUMN_NAME) as COLUMN_NAME,
	CASE 	WHEN UPPER(UDT_NAME) = 'BPCHAR' THEN 'CHAR'
		ELSE UPPER(UDT_NAME) 
	END AS DATA_TYPE,
	CHARACTER_MAXIMUM_LENGTH AS DATA_LENGTH,
	TCC.CONSTRAINT_TYPE as CONSTRAINT_TYPE,  
	CASE WHEN ISC.is_nullable = 'NO' THEN 'N' ELSE 'Y' END AS NULLABLE,  
	CASE WHEN LastIndexOf(COLUMN_DEFAULT, '::') < 0 THEN COLUMN_DEFAULT
		 ELSE substr(COLUMN_DEFAULT, 0, LastIndexOf(COLUMN_DEFAULT, '::'))
	END AS DATA_DEFAULT,
	PD.DESCRIPTION as DESCRIPTION
FROM INFORMATION_SCHEMA.COLUMNS ISC
	LEFT JOIN (
		SELECT
			DESCRIPTION,
			OBJSUBID 
		FROM PG_DESCRIPTION PD
		WHERE PD.OBJOID = (SELECT RELID FROM PG_STAT_ALL_TABLES PS WHERE PS.RELNAME  = @TableName)
	) PD
		ON ISC.ORDINAL_POSITION = PD.OBJSUBID
	LEFT JOIN (
		SELECT 
			COLUMN_NAME,
			string_agg(CONSTRAINT_TYPE, ',') AS CONSTRAINT_TYPE
		FROM (
			SELECT 	
				CASE WHEN TC.CONSTRAINT_TYPE = 'PRIMARY KEY' THEN 'P.K'
					WHEN TC.CONSTRAINT_TYPE = 'FOREIGN KEY' THEN 'F.K'
					WHEN TC.CONSTRAINT_TYPE = 'UNIQUE' THEN 'UNIQUE'
					ELSE TC.CONSTRAINT_TYPE
				END AS CONSTRAINT_TYPE,		
				KCU.COLUMN_NAME
			FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS TC
				LEFT JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU 
					 ON TC.CONSTRAINT_CATALOG = KCU.CONSTRAINT_CATALOG
					AND TC.CONSTRAINT_SCHEMA = KCU.CONSTRAINT_SCHEMA
					AND TC.CONSTRAINT_NAME = KCU.CONSTRAINT_NAME
				LEFT JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS RC
					 ON TC.CONSTRAINT_CATALOG = RC.CONSTRAINT_CATALOG
					AND TC.CONSTRAINT_SCHEMA = RC.CONSTRAINT_SCHEMA
					AND TC.CONSTRAINT_NAME = RC.CONSTRAINT_NAME
				LEFT JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE CCU
					 ON RC.UNIQUE_CONSTRAINT_CATALOG = CCU.CONSTRAINT_CATALOG
					AND RC.UNIQUE_CONSTRAINT_SCHEMA = CCU.CONSTRAINT_SCHEMA
					AND RC.UNIQUE_CONSTRAINT_NAME = CCU.CONSTRAINT_NAME
			WHERE 1 = 1 
			  AND TC.table_schema NOT IN ('pg_catalog', 'information_schema')
			  AND KCU.COLUMN_NAME is not null
			  AND TC.TABLE_NAME = @TableName
		) TC
		GROUP BY COLUMN_NAME
	) TCC
		ON ISC.COLUMN_NAME = TCC.COLUMN_NAME
WHERE 1 = 1
  AND ISC.table_schema NOT IN ('pg_catalog', 'information_schema')
  AND ISC.TABLE_NAME = @TableName
ORDER BY ORDINAL_POSITION;